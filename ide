#!/bin/env bash

# SHARING IS CARING
#   - https://tmate.io/
#   - https://unix.stackexchange.com/questions/2523/what-are-other-ways-to-share-a-tmux-session-between-two-users
# https://gist.github.com/sdondley/b01cc5bb1169c8c83401e438a652b84e
# fullscreen split - https://unix.stackexchange.com/questions/124310

# Use PIPES for race conditions in pane creation commands
#   - https://www.manniwood.com/2021_08_02/fun_with_tmux.html
DELAY=0.5 # shell load wait time
NAME="devpunks" # NAME of environment
SOCKET="${HOME}/${NAME}" # See tmux -L <socket> flag
SOCK="${SOCKET}.sock" # See tmux -S <sock file> flag
SESSION="${NAME}ðŸ˜ˆstudio" # used throughout (i.e. VIM session name)

echo COLUMNS $COLUMNS
echo LINES $LINES

# Setup a session work space called `$SESSION
# See tmux -L|S <socket|file> flag
# -L SOCKET NAME
# -S SOCKET PATH
# -s SESSION NAME
# -x - -y - (Current $TERM size)
tmux -C -S $SOCKET new-session -d -s $SESSION -x - -y -
echo $SOCKET

# Rename window
tmux -S $SOCKET rename-window 'DEV'

# Split pane vertically by 30%
tmux -S $SOCKET split-window -h -l 40%
sleep $DELAY
tmux -S $SOCKET send-keys 'git status' Enter

# Split pane 1 horizontally
tmux -S $SOCKET split-window -v -l 30%
sleep $DELAY
tmux -S $SOCKET send-keys 'pwd' Enter

# Split first pane horizontally
tmux -S $SOCKET select-pane -t 1
tmux -S $SOCKET split-window -t 1 -v -l 20%
sleep $DELAY
tmux -S $SOCKET send-keys 'clear' Enter

# Jump back to first window
tmux -S $SOCKET select-pane -t 1
sleep $DELAY
tmux -S $SOCKET send-keys 'vi' Enter

# Create next window
tmux -S $SOCKET new-window

# Select STATS window
tmux -S $SOCKET next-window

# Rename window
tmux -S $SOCKET rename-window 'STATS'
tmux -S $SOCKET select-pane-t 1

# attach to new session
# -vv tmux-client-PID.log & tmux-server-PID.log & tmux-out-PID.log
tmux -S $SOCKET -vv -u2 attach -t $SESSION
