############################################################################
#  _
# | |_ _ __ ___  _   ___  __
# | __| '_ ` _ \| | | \ \/ /
# | |_| | | | | | |_| |>  <
#  \__|_| |_| |_|\__,_/_/\_\
#    - https://man.openbsd.org/OpenBSD-current/man1/tmux.1
#
# `property not found` issue:
#    - https://github.com/tmux/tmux/issues/1689
#
#  Cheatsheets:
#    - https://devhints.io/tmux
#    - https://tao-of-tmux.readthedocs.io
#    - https://jdhao.github.io/2021/01/25/tmux_cheatsheet
#    - https://www.seanh.cc/2020/12/28/setting-options-in-tmux/
#
#  WIKI:
#    - https://github.com/tmux/tmux/wiki
#    - https://github.com/tmux/tmux/wiki/FAQ#how-do-i-translate--fg--bg-and--attr-options-into--style-options
#
############################################################################
# run-shell
#  - https://unix.stackexchange.com/questions/80473/how-do-i-run-a-shell-command-from-tmux-conf
# display-popup
#  popup-style, popup-border-style [rounded|simple|heavy|double], popup-border-lines
#  - https://github.com/tmux/tmux/issues/1842
#  - https://aliquote.org/post/tmux-little-hacks/
#  - https://blog.meain.io/2020/tmux-flating-scratch-terminal/
#  - https://gist.github.com/LintaoAmons/22f6184b26bd5b93d8fe9f9276f50f75


############################################################################
# {{{ Options
#  - https://superuser.com/questions/758843
#  - https://superuser.com/questions/1425921
############################################################################

#### set-clipboard

# set-option -s(erver) --------------------------------------------------------
%hidden BAR='BAZ'
# set-environment -g DEVPUNKS 😈ROOOCKS
#backspace=BACKSPACE
# show-environment -g
# display-menu '😈devPunks'
# display-menu -t 1 -T "devPunks" -x 0 -y 0 "🤘😈🤘hello" z lsp
# display-message '😈devPunks'
# display-message -p '#{BAR} #{PREFIX} #{DEVPUNKS}'
# Interesting! ENVVARS only available via `display`
# set -s @pwd="#{PWD}"

set-option -s editor vi
# https://invisible-island.net/xterm/ctlseqs/ctlseqs.html#h3-FocusIn_FocusOut
set-option -s focus-events on # for (neo|g)vim - https://github.com/vim/vim/pull/7673
set-option -s escape-time 50 # https://unix.stackexchange.com/questions/608142
set-option -s buffer-limit 10
set-option -s message-limit 100
set-option -s prompt-history-limit 100
set-option -s history-file '~/.tmux_history'
# https://unix.stackexchange.com/questions/1045/getting-256-colors-to-work-in-tmux
set-option -s default-terminal 'tmux-256color'
# https://github.com/tmux/tmux/wiki/FAQ#how-do-i-use-a-256-colour-terminal
set-option -s terminal-features ":256:RGB:ccolour:cstyle:ustyle:clipboard:mouse:focus:hyperlinks:strikethrough:sync:title:"
# https://github.com/tmux/tmux/issues/2606
# https://unix.stackexchange.com/questions/568260/how-is-default-terminal-compared-to-tmux-terminal-overrides/568263#568263
set-option -as terminal-overrides ',*-256color*:RGB:Tc' # See TMUX TERMINFO
# sane scrolling - https://superuser.com/questions/209437
# https://github.com/tmux/tmux/wiki/FAQ#why-are-tmux-pane-separators-dashed-rather-than-continuous-lines
set-option -as terminal-overrides ':XT:U8=0:smcup@:rmcup@' # XtermTitle/UP and DOWN arrows

# set-option -g(lobal session) -------------------------------------------------
set-option -g prefix C-a # Reset Prefix to Control + a
set-option -g mode-keys vi   # Use vim keybindings in copy mode
set-option -g xterm-keys on  # for vim
set-option -g status-keys vi # vi movement keys
# holding arrow keys - https://blog.meain.io/2020/tmux-flating-scratch-terminal/
set-option -g repeat-time 1000
# https://stackoverflow.com/questions/18760281
set-option -g history-limit 1000
set-option -g default-shell $SHELL
# https://stackoverflow.com/questions/21947123/prevent-tmux-from-displaying-activity-in-window-n
# ittps://unix.stackexchange.com/questions/78093/how-can-i-make-tmux-monitor-a-window-for-inactivity
set-option -g visual-bell both
set-option -g visual-silence both
set-option -g visual-activity on
set-option -g monitor-bell on
set-option -g monitor-silence 1000
set-option -g monitor-activity on
set-option -g bell-action any # [any|current|other|none]
set-option -g silence-action any  # [any|current|other|none]
set-option -g activity-action any # [any|current|other|none]

# TODO: REFACTOR
# set-option -p(ane) --------------------------------------------------------
set-option -g mode-style fg=colour13,reverse,bold # selection highlighting
set-option -g window-style fg=default,dim,bg=terminal
set-option -g window-active-style fg=default,nodim,bg=brightblack

set-option -g pane-base-index 1
set-option -g pane-border-status top
set-option -g pane-border-format "＜ #I. #T ＞"
set-option -g pane-border-indicators both # [colour|arrows|both]
set-option -g pane-border-lines heavy # [single|double|heavy|number]
set-option -g display-panes-colour magenta
set-option -g display-panes-active-colour brightmagenta
set-option -g pane-border-style fg=green,bold,bg=terminal
set-option -g pane-active-border-style fg=red,bold,bg=brightblack

# set-window-option -g(lobal) -----------------------------------------------
set-window-option -g mouse on
set-window-option -g base-index 1
set-window-option -g fill-character '😈'
set-window-option -g cursor-colour color11
set-window-option -g renumber-windows on # when window is closed
set-window-option -g clock-mode-style 24
set-window-option -g clock-mode-colour color13
# https://superuser.com/questions/1708413/how-to-automatically-rename-tmux-window-to-an-aliased-command
set-window-option -g automatic-rename on # Automatically set window title
set-window-option -g automatic-rename-format '#{:window_marked_flag/:window_name}#{b:pane_title/~/:pane_current_command/:command}'
set-window-option -g allow-passthrough on # escape keys
set-window-option -g display-time 4000 # 0 press any key to cancel
# Pane number display (Ctl-b)+q - https://unix.stackexchange.com/questions/307696
set-window-option -g display-panes-time 4000

# By default, all windows in a session are constrained to the size of the
# smallest client connected to that session,
# even if both clients are looking at different windows.
# It seems that in this particular case, Screen has the better default
# where a window is only constrained in size if a smaller client
# is actively looking at it.
set-window-option -g aggressive-resize on

# }}}

# ############################################################################
# {{{ Unbindings
# ############################################################################

unbind [ # copy mode bound to escape key
unbind j
unbind C-b # unbind default leader key
unbind '"' # unbind horizontal split
unbind %   # unbind vertical split
unbind '(' # unbind kill previous session

# }}}

############################################################################
# {{{ Bindings
# - https://man.openbsd.org/OpenBSD-current/man1/tmux.1#DEFAULT_KEY_BINDINGS
############################################################################
bind-key a send-prefix # for nested tmux sessions

# reload tmux conf
bind-key R source-file ~/.tmux.conf \; \
display-message "Source file loaded!"

bind-key Escape copy-mode

# # break-pane
bind-key -n 'M-Space' resize-pane -Z

# https://superuser.com/questions/600286/move-pane-to-a-new-window-in-tmux
#  join-pane [-dhv] [-l size | -p percentage] [-s src-pane]
#  [-t:dst-window.dst-pane] (destination window (dot) destination pane
#                 (alias: joinp)
# bind C-j command-prompt "join-pane"
# bind-key j command-prompt "join-pane -s '%%'"
# bind-key Space command-prompt "joinp -t:%%" # %% = prompt for window.pane [-V|H] # vert|hor split

# {{{ windows -----------------------------------------------
# Drag to re-order windows
bind-key -n MouseDrag1Status swap-window -t=
# Double click on the window list to open a new window
bind-key -n DoubleClick1Status command-prompt 'new-window -n%%'

bind-key M-n next-window
bind-key M-p previous-window
bind-key A command-prompt 'rename-window %%'
bind-key C-n command-prompt 'new-window -n%%'

# kill -9
bind-key 'C-9' kill-window
bind-key 'C-(' send -X kill-session

# }}}

# {{{ panes -----------------------------------------------
# use the vim motion keys to move between panes
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# kill
bind-key 9 kill-pane

#previous pane
bind-key C-up prev
bind-key C-left prev

#next pane
bind-key C-right next
bind-key C-down next

# }}}

# {{{ resizing -----------------------------------------------
bind-key C-h resize-pane -L 7
bind-key C-j resize-pane -D 7
bind-key C-k resize-pane -U 7
bind-key C-l resize-pane -R 7

# }}}

# {{{ layouts -----------------------------------------------
# Issue with special characters for tmux > 3.x
#   - https://github.com/tmux/tmux/issues/1827

bind-key 'M-r' rotate-window

bind-key 'M--' split-window -v # split pane horizontally
bind-key 'M-\' split-window -h # split pane vertically

# layouts tiled, even-horizontal, even-vertical, main-horizontal, main-vertical
bind-key 'C-=' select-layout "tiled"
bind-key 'C--' select-layout "even-vertical"
bind-key 'C-\' select-layout "even-horizontal"

# }}}

# }}}

############################################################################
# {{{ Status Bar
#   - Formats -- https://github.com/tmux/tmux/wiki/Formats
#   - https://tao-of-tmux.readthedocs.io/en/latest/manuscript/09-status-bar.html
############################################################################
set-window-option -g window-status-bell-style fg=blue,bold,bg=red
set-window-option -g window-status-activity-style fg=black,bg=cyan

set-window-option -g status 5 # lines (on|0-5|off)
set-window-option -g status-interval 5
set-window-option -g status-position top
set-window-option -g status-justify absolute-centre # left, (absolute-)centre, right

set-window-option -g set-titles on
set-window-option -g set-titles-string '#H:#S'

# Multiple Status Lines
set-window-option -g status-bg black
set-window-option -g status-fg magenta
set-window-option -g status-format[1] ' HOLY SHIT ' # second line

set-window-option -g window-status-separator '|'
set-window-option -g window-status-format ' win #F #W '
set-window-option -g window-status-current-format ' ◎ #F #W '

# set-window-option -g window-status-current-format '#[fg=colour234]#[bg=magenta]◢#[default] ◉#[fg=default,underscore]#F#W #[default] #[fg=colour234]#[bg=magenta]◣#[default]'

set-window-option -g status-style fg=red,bg=blue
set-window-option -g window-status-style fg=white,bg=black
set-window-option -g window-status-current-style fg=black,bold,bg=white

set-window-option -g message-line 2 # rows (0-5)
set-window-option -g message-command-style fg=colour132,bg=black
# set-window-option -g message-style fg=brightmagenta,blink,bold,reverse,bg=colour234
# Titles (window number, program name, active (or not)
# https://unix.stackexchange.com/questions/60968/tmux-bottom-bar-color-change/60969

# set-window-option -g status-left-length 70
# set -g status-left-style fg=default,bold,bg=default
# https://stackoverflow.com/questions/16624752/tmux-how-to-configure-tmux-to-display-the-current-working-directory-of-a-pane-o
# set-window-option -g status-left  '#[bg=brightmagenta,dim,italics]#[fg=colour0,bold]📂#{=70:pane_current_path} #[default]'
# set-window-option -g status-right-length 40
# set-window-option -g status-right-style ''
# set-window-option -g status-right '#[fg=colour231,italics]👨🏾‍💻#S #[default]#[fg=colour143,dim]🕛 %m-%d %R#(acpi | cut -d ',' -f 2) #[default]'

# set-window-option -ga status-left ''
# set-window-option -ga status-right ''

# }}}
